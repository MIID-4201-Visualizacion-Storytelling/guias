<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>guias</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><base href="/guias/"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" data-hid="gf-prefetch" rel="dns-prefetch" href="https://fonts.gstatic.com/"><link data-n-head="ssr" data-hid="gf-preconnect" rel="preconnect" href="https://fonts.gstatic.com/" crossorigin=""><link data-n-head="ssr" data-hid="gf-preload" rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Material+Icons"><script data-n-head="ssr" data-hid="gf-script">!function(){var e=document.createElement("link");e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Material+Icons",document.querySelector("head").appendChild(e)}()</script><noscript data-n-head="ssr" data-hid="gf-noscript"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons"></noscript><link rel="preload" href="/guias/_nuxt/db63cf2.js" as="script"><link rel="preload" href="/guias/_nuxt/ec44050.js" as="script"><link rel="preload" href="/guias/_nuxt/698f376.js" as="script"><link rel="preload" href="/guias/_nuxt/a0521a0.js" as="script"><link rel="preload" href="/guias/_nuxt/9356d93.js" as="script"><style data-vue-ssr-id="6f9fdb80:0 517a8dd7:0 fa7ff0ca:0">html{box-sizing:border-box;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}*,:after,:before{box-sizing:inherit}body,html{margin:0;padding:0}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre,time{margin:0}h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;font-weight:700}body{min-height:100vh}button{background:0 0;border:0;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset{border:0;margin:0;padding:0}iframe{border:0}ul{list-style:none;padding:0}ul li{margin:1em 0}ul li:before{content:"";width:.5em;height:.5em;display:inline-block;vertical-align:middle;background-color:#2fc1d5;margin-right:.5em;border-radius:30%}img,video{max-width:100%;height:auto}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;font-weight:400}a,a:link{text-decoration:none}::-moz-selection{background-color:#f3f0ab;color:#000}::selection{background-color:#f3f0ab;color:#000}p{line-height:1.6;margin:1.5em 0}article,h1{margin:1em}h1{text-align:center;font-size:2em}h2{border-bottom:3px solid #623c97;padding-bottom:.5em;font-size:1.6em;margin-bottom:.3em}h3{border-bottom:1px dotted;padding:.5em 0;font-size:1.3em;margin-bottom:.7em}h4{font-size:1.1em}.title-icon{text-align:center;display:block;font-size:2.2em}.title-icon.non-material{width:1.5em;margin:0 auto}.subtitle-icon{color:#2fc1d5;font-size:1.2em;display:inline-block;vertical-align:middle}.inline-icon{width:32px;height:auto;display:inline-block;vertical-align:bottom;margin:1em .5em 0}table{border-collapse:collapse}th{border:1px solid}td,th{padding:.5em}td{border:1px dotted}.check{display:inline-block;vertical-align:bottom;padding-right:.3em;color:green}.check.no-puede{color:red}.check.puede{color:#767a7d}#tutorial-gds{width:100%;margin:0;height:80vh}blockquote{background-color:#ddd;font-size:.8em}blockquote p{padding:1em}.iframe-container{position:relative;overflow:hidden;width:100%;padding-top:66.66%}.iframe-container iframe{position:absolute;top:0;left:0;bottom:0;right:0;width:100%;height:100%}.historia{font-size:1.2em;background-color:rgba(231,224,87,.71373);font-weight:700;padding:1em;margin:1em 3em;color:#3c6da5}#api{background-color:#353e50;color:#fff;padding:1em}#api,#api .icono{display:inline-block}#api .icono{vertical-align:middle;margin:5px;text-align:center}#api .icono p{margin:0;max-width:80px;line-height:1}#api .material-icons{font-size:2.2em;color:#d4dcec}#api .material-icons.servicio{font-size:3em;color:#cddfe7}#api .texto{border:1px solid #ecebca;padding:.5em;border-radius:5px}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}</style><link rel="preload" href="/guias/_nuxt/static/1644310522/4-2-herramienta-propia/state.js" as="script"><link rel="preload" href="/guias/_nuxt/static/1644310522/4-2-herramienta-propia/payload.js" as="script"><link rel="preload" href="/guias/_nuxt/static/1644310522/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><main><article><h1>Crear una herramienta propia para analytics</h1> <div class="nuxt-content"><h2 id="introducción"><a href="#introducci%C3%B3n" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Introducción</h2>
<p>En este tutorial van a crear la siguiente aplicación que muestra, en tiempo real, las fluctuaciones en precio de varias criptomonedas:</p>
<div class="iframe-container">
  <iframe width="600" height="450" src="https://precios-criptomonedas-funcional.1cgonza.repl.co/" frameborder="0" style="border:0"></iframe>
</div>
<blockquote>
<p><strong>Figura 1</strong><br>
<em>Cambio de precios en criptomonedas</em></p>
</blockquote>
<p>Vamos a hacerlo juntos, paso por paso, así que no se preocupen si nunca han creado una aplicación web. La idea con este tutorial es que se hagan a una idea general del proceso de visualización por medio de la programación. Vamos a hacer paralelos con lo que han aprendido de Google Data Studio para que puedan reconocer las similitudes y diferencias entre las herramientas prediseñadas y la creación de una herramienta propia. Con estas bases pueden explorar autónomamente nuevas fuentes de datos con diferentes APIs en futuros proyectos.</p>
<h3 id="espacio-de-trabajo"><a href="#espacio-de-trabajo" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Espacio de trabajo</h3>
<p>Para este ejercicio vamos a trabajar en Replit, una herramienta que nos permite crear aplicaciones en diferentes lenguajes de programación, directamente en el explorador sin tener que descargar o instalar nada.</p>
<ul>
<li>Paso 1: Crear cuenta en Replit
Primero van a <a href="https://replit.com/" target="_blank"></a><a href="https://replit.com/" rel="nofollow noopener noreferrer" target="_blank">https://replit.com/</a> y seleccionan la opción “Sign Up” en la esquina superior derecha. Se pueden registrar con su cuenta de Google, Github, Facebook o directamente diligenciando el formulario. Con esto ya tienen una cuenta gratuita que es suficiente para este ejercicio.</li>
<li>Paso 2: Hacer copia (Fork) de la plantilla
Luego de crear la cuenta, van al siguiente enlace: <a href="https://replit.com/@1cgonza/Criptomonedas-Precios?v=1" target="_blank"></a><a href="https://replit.com/@1cgonza/Criptomonedas-Precios?v=1" rel="nofollow noopener noreferrer" target="_blank">https://replit.com/@1cgonza/Criptomonedas-Precios?v=1</a> y hacen clic en el botón <strong>“Fork repl”</strong> que les debe aparecer a la derecha como se ve en la Figura 2 a continuación:</li>
</ul>
<img src="/guias/vysimgs/fork-repl.jpg" alt="Fork Repl">
<blockquote>
<p><strong>Figura 2</strong><br>
<em>Crear Fork de la plantilla en Replit</em></p>
</blockquote>
<p>El “Fork” crea una copia exacta de la plantilla, pero los cambios que hagan les pertenecen a ustedes. Todos los cambios que hagan en el código se guardan automáticamente y pueden volver a su cuenta en cualquier momento para seguir trabajando en la aplicación.</p>
<h3 id="interfaz-de-replit"><a href="#interfaz-de-replit" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Interfaz de Replit</h3>
<p>Luego de crear el "Fork", van a entrar a la interfaz de trabajo que está dividida en 3 partes:</p>
<ul>
<li>La lista de archivos a la izquierda.</li>
<li>El editor de código en el centro.</li>
<li>El visor de la aplicación a la derecha.</li>
</ul>
<img src="/guias/vysimgs/interfaz-replit.jpg" alt="interfaz Replit">
<blockquote>
<p><strong>Figura 3</strong><br>
<em>Interfaz Replit</em></p>
</blockquote>
<p>Ahora hagan clic en el botón verde “Run” para ver la plantilla en su estado inicial en el visor, se debe ver algo similar a esto:</p>
<img src="/guias/vysimgs/vista1.jpg" alt="interfaz Replit, vista">
<blockquote>
<p><strong>Figura 4</strong><br>
<em>Aplicación corriendo dentro de Replit</em></p>
</blockquote>
<p>Está bastante vacía, apenas tenemos algunos campos de texto y pueden ver que algunos de esos textos cambian de manera dinámica. A pesar de la apariencia escueta que tiene la aplicación en este momento, ya están sucediendo bastantes cosas internamente: tenemos un esqueleto de las secciones que vamos a crear en el archivo “index.html”, también tenemos un archivo para definir estilos que se llama “style.css” y en el archivo “scripts.js” tenemos ya funcionando la conexión a la API con WebSockets y unas bases de modelado. Primero veamos como editar la estructura en HTML.</p>
<h3 id="html"><a href="#html" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>HTML</h3>
<p>El archivo de HTML en una aplicación web es la estructura del sitio y está dividido en dos secciones principales: <code>head</code> y <code>body</code>. En el head tenemos metadatos y cargamos archivos necesarios como el de “style.css”. Lo que esta en esta sección no se ve en la página, mientras que todo lo que esta dentro de body si se ve en la página así que nos vamos a enfocar en lo que esta dentro de <code>body</code>.</p>
<p>Todo en HTML funciona por bloques, por ejemplo:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Título 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Titulo 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>párrafo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!—-</span> <span class="token attr-name">los</span> <span class="token attr-name">div</span> <span class="token attr-name">son</span> <span class="token attr-name">contenedores</span> <span class="token attr-name">genéricos</span> <span class="token attr-name">--</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre></div>
<p>El orden en el que ponen cada bloque es importante, ya que la página se construye de arriba abajo. Como pueden ver, el "Título 1" está de primero y es lo primero que se ve en la página. Ahora, cambien el contenido de <code>&lt;h1>&lt;/h1></code> y le dan clic al botón “Run” de nuevo para ver sus cambios en el visor. Escriban lo que quieran, luego van a usar este bloque para ponerle un título a su aplicación.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>titulo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>HOLA! Yo soy el título<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
</code></pre></div>
<p>En este archivo quiero que editen el Título y más abajo van a encontrar una sección llamada "descripción". Allí van a reemplazar los textos que dicen "Párrafo 1 ...." y "Parrafo 2 ....." con el texto descriptivo que van a redactar cuando terminen de crear su aplicación. Esto lo pueden hacer al final cuando entiendan mejor cómo funciona la visualización.</p>
<p>Si quieren ampliar sobre conceptos de HTML, les recomiendo los tutoriales de <a href="https://www.w3schools.com/html/" target="_blank">W3School HTML Tutorial</a>.</p>
<h3 id="css"><a href="#css" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>CSS</h3>
<p>Esta semana no vamos a hacer mucho énfasis en el diseño, pero el archivo de "styles.css" les permite modificar los estilos de todos los elementos que tienen en el HTML. La sintaxis es un poco diferente a la de HTML y pueden investigar todas las opciones de diseño en <a href="https://www.w3schools.com/css/default.asp" target="_blank">W3School CSS Tutorial</a>. Les dejé en la plantilla una estructura muy sencilla si quieren trabajar en el diseño aunque no lo tienen que hacer para esta semana. A continuación les muestro como hacer unos cambios al estilo para que se hagan a una idea general:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-css"><code><span class="token selector"><span class="token id">#titulo</span></span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">cadetblue</span><span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token id">#descripcion</span></span> <span class="token punctuation">{</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span> solid <span class="token hexcode color">#000</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token id">#descripcion</span> p</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3 id="javascript"><a href="#javascript" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>JavaScript</h3>
<p>En el archivo "scripts.js" es donde vamos a crear nuestra aplicación. Desde este archivo podemos modificar la estructura y el contenido del HTML o los estilos del CSS de manera dinámica.</p>
<p>En el JavaScript vamos a hacer 3 cosas que vienen haciendo en <em>Google Data Studio</em>:</p>
<ol>
<li>Conectar la aplicación a una fuente de datos.</li>
<li>Modelar los datos.</li>
<li>Crear las visualizaciones.</li>
</ol>
<h4 id="conexión-con-datos-en-tiempo-real"><a href="#conexi%C3%B3n-con-datos-en-tiempo-real" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Conexión con datos en tiempo real</h4>
<p>En el tutorial anterior vimos como conectarse a la API de <em>CoinCap</em> por el protocolo de WebSockets con la siguiente estructura:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-js"><code><span class="token comment">// Conectammos nuestra aplicación al API de coincap.</span>
<span class="token comment">// Vamos a solicitar actualizaciones de precios para: bitcoin, ethereum, monero y litecoin.</span>
<span class="token keyword">var</span> preciosEndPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://ws.coincap.io/prices?assets=bitcoin,ethereum,monero,litecoin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cuando una de las criptomonedas cambia de precio, ejecutamos la función procesarNuevoMensaje.</span>
preciosEndPoint<span class="token punctuation">.</span><span class="token property-access">onmessage</span> <span class="token operator">=</span> procesarNuevoMensaje<span class="token punctuation">;</span>

<span class="token comment">// Función que recibe los mensajes del Socket</span>
<span class="token keyword">function</span> <span class="token function">procesarNuevoMensaje</span><span class="token punctuation">(</span><span class="token parameter">mensaje</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Convertimos los datos de texto a formato JSON</span>
  <span class="token keyword">var</span> mensajeJson <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>mensaje<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Más adelante en el tutorial voy a explicar el resto de lo que ven dentro de esta función.</span>
  <span class="token comment">// ....</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="estructura-para-modelado-de-datos"><a href="#estructura-para-modelado-de-datos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Estructura para modelado de datos</h4>
<p>La semana pasada vimos como limpiar y modelar los datos por medio de scripts en <em>Google Data Studio</em>. Este proceso nos ayudó a convertir la estructura original de los datos a una nueva estructura que tiene sentido para nuestra investigación. En el caso de <em>CoinCap</em>, estamos conectados a la API para que nos envíe datos en el momento que cambia el precio de alguna criptomoneda que nos interesa. La estructura original que nos llega es simplemente el nombre de la moneda y su valor actual que se ve así en formato JSON:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-json"><code><span class="token punctuation">{</span>
  <span class="token property">"bitcoin"</span><span class="token operator">:</span> <span class="token string">"6389.06534240"</span><span class="token punctuation">,</span>
  <span class="token property">"ethereum"</span><span class="token operator">:</span> <span class="token string">"192.93111286"</span><span class="token punctuation">,</span>
  <span class="token property">"monero"</span><span class="token operator">:</span> <span class="token string">"108.90302506"</span><span class="token punctuation">,</span>
  <span class="token property">"litecoin"</span><span class="token operator">:</span> <span class="token string">"52.25484165"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Para enriquecer estos datos y producir un valor agregado, podemos crear una nueva estructura con información que vamos calculando a medida que corre la aplicación. En la plantilla van a encontrar esa estructura armada de la siguiente manera:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-js"><code><span class="token keyword">const</span> monedas <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> nombre<span class="token operator">:</span> <span class="token string">'bitcoin'</span><span class="token punctuation">,</span> precioActual<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> precioMasAlto<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> precioMasBajo<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> datos<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> nombre<span class="token operator">:</span> <span class="token string">'ethereum'</span><span class="token punctuation">,</span> precioActual<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> precioMasAlto<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> precioMasBajo<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> datos<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> nombre<span class="token operator">:</span> <span class="token string">'monero'</span><span class="token punctuation">,</span> precioActual<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> precioMasAlto<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> precioMasBajo<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> datos<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> nombre<span class="token operator">:</span> <span class="token string">'litecoin'</span><span class="token punctuation">,</span> precioActual<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> precioMasAlto<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> precioMasBajo<span class="token operator">:</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> datos<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div>
<p>En esta lista (o array), creamos un objeto por cada una de las criptomonedas que le estamos solicitando a la API. Inicialmente no tienen ningún valor y vamos a ir actualizando esta estructura a medida que recibimos datos.</p>
<h4 id="procesamiento-y-modelado-de-los-datos"><a href="#procesamiento-y-modelado-de-los-datos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Procesamiento y modelado de los datos</h4>
<p>Volamos ahora a la función donde recibimos mensajes nuevos de la API para introducirlos a la estructura que definimos en la variable <code>const monedas = [...]</code> anteriormente:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-js"><code><span class="token comment">// Función que recibe los mensajes del Socket</span>
<span class="token keyword">function</span> <span class="token function">procesarNuevoMensaje</span><span class="token punctuation">(</span><span class="token parameter">mensaje</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Convertimos los datos de texto a formato JSON</span>
  <span class="token keyword">var</span> mensajeJson <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>mensaje<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Iteramos sobre los valores del mensaje que vienen en parejas de "nombre": "precio"</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> nombreMoneda <span class="token keyword">in</span> mensajeJson<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// En el siguiente loop, pasamos por cada objeto que definimos en la variable "monedas" que contiene la nueva estructura de datos que queremos llenar.</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> monedas<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// objetoMoneda va a ser cada uno de los objetos del modelado, por ejemplo:</span>
      <span class="token comment">// cuando i = 0, objetoMoneda es: {nombre: "bitcoin", precioActual: null, precioMasAlto: null, precioMasBajo: null, datos: []}</span>
      <span class="token keyword">var</span> objetoMoneda <span class="token operator">=</span> monedas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token comment">// Comparamos el nombre de la moneda en nuestro modelo con el nombre de la moneda que cambió de valor y fue enviado por la API en el mensaje actual.</span>
      <span class="token comment">// Si coinciden, significa que podemos actualizar los datos de nuestro modelo para esa moneda</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>objetoMoneda<span class="token punctuation">.</span><span class="token property-access">nombre</span> <span class="token operator">===</span> nombreMoneda<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Extraemos el precio actual que llegó en el mensaje y lo guardamos en una variable para usarla varias veces de ahora en adelante.</span>
        <span class="token keyword">var</span> nuevoPrecio <span class="token operator">=</span> mensajeJson<span class="token punctuation">[</span>nombreMoneda<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// En JavaScript, podemos insertar un nuevo elemento a un array usando push()</span>
        <span class="token comment">// Aquí estamos sumando una nueva entrada a los datos de la moneda que acaba de cambiar el precio.</span>
        <span class="token comment">// En nuestra estructura de modelado: {nombre: "bitcoin", precioActual: null, precioMasAlto: null, precioMasBajo: null, datos: []}</span>
        <span class="token comment">// va a quedar guardada en el array "datos"</span>
        objetoMoneda<span class="token punctuation">.</span><span class="token property-access">datos</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          fecha<span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Este va a ser nuestro eje X, usamos la fecha del presente ya que la aplicación funciona en tiempo real.</span>
          precio<span class="token operator">:</span> nuevoPrecio<span class="token punctuation">,</span> <span class="token comment">// El eje Y en la visualización va a ser el precio.</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Volviendo a la estructura: {nombre: "bitcoin", precioActual: null, precioMasAlto: null, precioMasBajo: null, datos: []}</span>
        <span class="token comment">// podemos cambiar directamente el precioActual de la moneda con el precio que acaba de llegar de la API.</span>
        objetoMoneda<span class="token punctuation">.</span><span class="token property-access">precioActual</span> <span class="token operator">=</span> nuevoPrecio<span class="token punctuation">;</span>

        <span class="token comment">// Ahora hagamos algo más interesante, vamos a guardar el precio más alto al que ha llegado la moneda.</span>
        <span class="token comment">// La siguiente comparación revisa si el valor NO es "null" con: !objetoMoneda.precioMasAlto,</span>
        <span class="token comment">// O si el precio que acaba de llegar es mayor al precioMasAlto guardado en nuestro modelo.</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>objetoMoneda<span class="token punctuation">.</span><span class="token property-access">precioMasAlto</span> <span class="token operator">||</span> objetoMoneda<span class="token punctuation">.</span><span class="token property-access">precioMasAlto</span> <span class="token operator">&lt;</span> nuevoPrecio<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// Si alguna de estas dos pruebas es verdadera, cambiamos el precioMasAlto en el modelo.</span>
          objetoMoneda<span class="token punctuation">.</span><span class="token property-access">precioMasAlto</span> <span class="token operator">=</span> nuevoPrecio<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Hacemos lo mismo para el precioMasBajo haciendo la comparación invertida.</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>objetoMoneda<span class="token punctuation">.</span><span class="token property-access">precioMasBajo</span> <span class="token operator">||</span> objetoMoneda<span class="token punctuation">.</span><span class="token property-access">precioMasBajo</span> <span class="token operator">></span> nuevoPrecio<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          objetoMoneda<span class="token punctuation">.</span><span class="token property-access">precioMasBajo</span> <span class="token operator">=</span> nuevoPrecio<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Para terminar, actualizamos la gráfica que tengamos seleccionada en el menú</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>nombreMoneda <span class="token operator">===</span> menu<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">actualizar</span><span class="token punctuation">(</span>monedas<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div></article></main></div></div><script defer src="/guias/_nuxt/static/1644310522/4-2-herramienta-propia/state.js"></script><script src="/guias/_nuxt/db63cf2.js" defer></script><script src="/guias/_nuxt/9356d93.js" defer></script><script src="/guias/_nuxt/ec44050.js" defer></script><script src="/guias/_nuxt/698f376.js" defer></script><script src="/guias/_nuxt/a0521a0.js" defer></script>
  </body>
</html>
